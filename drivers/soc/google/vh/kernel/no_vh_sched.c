// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright (C) 2023 Sultan Alsawaf <sultan@kerneltoast.com>.
 */

#include <linux/init.h>
#include <linux/proc_fs.h>
#include <linux/seq_file.h>

/* Keep libperfmgr happy when vendor_sched is gone */
static const char *const vh_sched_nodes[] = {
	"bg_prefer_high_cap",
	"bg_prefer_idle",
	"bg_preferred_idle_mask_high",
	"bg_preferred_idle_mask_low",
	"bg_preferred_idle_mask_mid",
	"bg_task_spreading",
	"bg_uclamp_max",
	"bg_uclamp_max_on_nice_enable",
	"bg_uclamp_max_on_nice_high_prio",
	"bg_uclamp_max_on_nice_high_value",
	"bg_uclamp_max_on_nice_low_prio",
	"bg_uclamp_max_on_nice_low_value",
	"bg_uclamp_max_on_nice_mid_prio",
	"bg_uclamp_max_on_nice_mid_value",
	"bg_uclamp_min",
	"bg_uclamp_min_on_nice_enable",
	"bg_uclamp_min_on_nice_high_prio",
	"bg_uclamp_min_on_nice_high_value",
	"bg_uclamp_min_on_nice_low_prio",
	"bg_uclamp_min_on_nice_low_value",
	"bg_uclamp_min_on_nice_mid_prio",
	"bg_uclamp_min_on_nice_mid_value",
	"bg_ug",
	"boost_adpf_prio",
	"cam_power_prefer_high_cap",
	"cam_power_prefer_idle",
	"cam_power_preferred_idle_mask_high",
	"cam_power_preferred_idle_mask_low",
	"cam_power_preferred_idle_mask_mid",
	"cam_power_task_spreading",
	"cam_power_uclamp_max",
	"cam_power_uclamp_max_on_nice_enable",
	"cam_power_uclamp_max_on_nice_high_prio",
	"cam_power_uclamp_max_on_nice_high_value",
	"cam_power_uclamp_max_on_nice_low_prio",
	"cam_power_uclamp_max_on_nice_low_value",
	"cam_power_uclamp_max_on_nice_mid_prio",
	"cam_power_uclamp_max_on_nice_mid_value",
	"cam_power_uclamp_min",
	"cam_power_uclamp_min_on_nice_enable",
	"cam_power_uclamp_min_on_nice_high_prio",
	"cam_power_uclamp_min_on_nice_high_value",
	"cam_power_uclamp_min_on_nice_low_prio",
	"cam_power_uclamp_min_on_nice_low_value",
	"cam_power_uclamp_min_on_nice_mid_prio",
	"cam_power_uclamp_min_on_nice_mid_value",
	"cam_power_ug",
	"cam_prefer_high_cap",
	"cam_prefer_idle",
	"cam_preferred_idle_mask_high",
	"cam_preferred_idle_mask_low",
	"cam_preferred_idle_mask_mid",
	"cam_task_spreading",
	"cam_uclamp_max",
	"cam_uclamp_max_on_nice_enable",
	"cam_uclamp_max_on_nice_high_prio",
	"cam_uclamp_max_on_nice_high_value",
	"cam_uclamp_max_on_nice_low_prio",
	"cam_uclamp_max_on_nice_low_value",
	"cam_uclamp_max_on_nice_mid_prio",
	"cam_uclamp_max_on_nice_mid_value",
	"cam_uclamp_min",
	"cam_uclamp_min_on_nice_enable",
	"cam_uclamp_min_on_nice_high_prio",
	"cam_uclamp_min_on_nice_high_value",
	"cam_uclamp_min_on_nice_low_prio",
	"cam_uclamp_min_on_nice_low_value",
	"cam_uclamp_min_on_nice_mid_prio",
	"cam_uclamp_min_on_nice_mid_value",
	"cam_ug",
	"dex2oat_prefer_high_cap",
	"dex2oat_prefer_idle",
	"dex2oat_preferred_idle_mask_high",
	"dex2oat_preferred_idle_mask_low",
	"dex2oat_preferred_idle_mask_mid",
	"dex2oat_task_spreading",
	"dex2oat_uclamp_max",
	"dex2oat_uclamp_max_on_nice_enable",
	"dex2oat_uclamp_max_on_nice_high_prio",
	"dex2oat_uclamp_max_on_nice_high_value",
	"dex2oat_uclamp_max_on_nice_low_prio",
	"dex2oat_uclamp_max_on_nice_low_value",
	"dex2oat_uclamp_max_on_nice_mid_prio",
	"dex2oat_uclamp_max_on_nice_mid_value",
	"dex2oat_uclamp_min",
	"dex2oat_uclamp_min_on_nice_enable",
	"dex2oat_uclamp_min_on_nice_high_prio",
	"dex2oat_uclamp_min_on_nice_high_value",
	"dex2oat_uclamp_min_on_nice_low_prio",
	"dex2oat_uclamp_min_on_nice_low_value",
	"dex2oat_uclamp_min_on_nice_mid_prio",
	"dex2oat_uclamp_min_on_nice_mid_value",
	"dex2oat_ug",
	"dvfs_headroom",
	"fg_prefer_high_cap",
	"fg_prefer_idle",
	"fg_preferred_idle_mask_high",
	"fg_preferred_idle_mask_low",
	"fg_preferred_idle_mask_mid",
	"fg_task_spreading",
	"fg_uclamp_max",
	"fg_uclamp_max_on_nice_enable",
	"fg_uclamp_max_on_nice_high_prio",
	"fg_uclamp_max_on_nice_high_value",
	"fg_uclamp_max_on_nice_low_prio",
	"fg_uclamp_max_on_nice_low_value",
	"fg_uclamp_max_on_nice_mid_prio",
	"fg_uclamp_max_on_nice_mid_value",
	"fg_uclamp_min",
	"fg_uclamp_min_on_nice_enable",
	"fg_uclamp_min_on_nice_high_prio",
	"fg_uclamp_min_on_nice_high_value",
	"fg_uclamp_min_on_nice_low_prio",
	"fg_uclamp_min_on_nice_low_value",
	"fg_uclamp_min_on_nice_mid_prio",
	"fg_uclamp_min_on_nice_mid_value",
	"fg_ug",
	"idle_balancer",
	"nnapi_prefer_high_cap",
	"nnapi_prefer_idle",
	"nnapi_preferred_idle_mask_high",
	"nnapi_preferred_idle_mask_low",
	"nnapi_preferred_idle_mask_mid",
	"nnapi_task_spreading",
	"nnapi_uclamp_max",
	"nnapi_uclamp_max_on_nice_enable",
	"nnapi_uclamp_max_on_nice_high_prio",
	"nnapi_uclamp_max_on_nice_high_value",
	"nnapi_uclamp_max_on_nice_low_prio",
	"nnapi_uclamp_max_on_nice_low_value",
	"nnapi_uclamp_max_on_nice_mid_prio",
	"nnapi_uclamp_max_on_nice_mid_value",
	"nnapi_uclamp_min",
	"nnapi_uclamp_min_on_nice_enable",
	"nnapi_uclamp_min_on_nice_high_prio",
	"nnapi_uclamp_min_on_nice_high_value",
	"nnapi_uclamp_min_on_nice_low_prio",
	"nnapi_uclamp_min_on_nice_low_value",
	"nnapi_uclamp_min_on_nice_mid_prio",
	"nnapi_uclamp_min_on_nice_mid_value",
	"nnapi_ug",
	"npi_packing",
	"ota_prefer_high_cap",
	"ota_prefer_idle",
	"ota_preferred_idle_mask_high",
	"ota_preferred_idle_mask_low",
	"ota_preferred_idle_mask_mid",
	"ota_task_spreading",
	"ota_uclamp_max",
	"ota_uclamp_max_on_nice_enable",
	"ota_uclamp_max_on_nice_high_prio",
	"ota_uclamp_max_on_nice_high_value",
	"ota_uclamp_max_on_nice_low_prio",
	"ota_uclamp_max_on_nice_low_value",
	"ota_uclamp_max_on_nice_mid_prio",
	"ota_uclamp_max_on_nice_mid_value",
	"ota_uclamp_min",
	"ota_uclamp_min_on_nice_enable",
	"ota_uclamp_min_on_nice_high_prio",
	"ota_uclamp_min_on_nice_high_value",
	"ota_uclamp_min_on_nice_low_prio",
	"ota_uclamp_min_on_nice_low_value",
	"ota_uclamp_min_on_nice_mid_prio",
	"ota_uclamp_min_on_nice_mid_value",
	"ota_ug",
	"pmu_poll_enable",
	"pmu_poll_time",
	"prefer_idle_clear",
	"prefer_idle_set",
	"reduce_prefer_idle",
	"rt_prefer_high_cap",
	"rt_prefer_idle",
	"rt_preferred_idle_mask_high",
	"rt_preferred_idle_mask_low",
	"rt_preferred_idle_mask_mid",
	"rt_task_spreading",
	"rt_uclamp_max",
	"rt_uclamp_max_on_nice_enable",
	"rt_uclamp_max_on_nice_high_prio",
	"rt_uclamp_max_on_nice_high_value",
	"rt_uclamp_max_on_nice_low_prio",
	"rt_uclamp_max_on_nice_low_value",
	"rt_uclamp_max_on_nice_mid_prio",
	"rt_uclamp_max_on_nice_mid_value",
	"rt_uclamp_min",
	"rt_uclamp_min_on_nice_enable",
	"rt_uclamp_min_on_nice_high_prio",
	"rt_uclamp_min_on_nice_high_value",
	"rt_uclamp_min_on_nice_low_prio",
	"rt_uclamp_min_on_nice_low_value",
	"rt_uclamp_min_on_nice_mid_prio",
	"rt_uclamp_min_on_nice_mid_value",
	"rt_ug",
	"sched_lib_affinity",
	"sched_lib_cpu_freq_cached",
	"sched_lib_freq_cpumask",
	"sched_lib_name",
	"set_proc_group_bg",
	"set_proc_group_cam",
	"set_proc_group_cam_power",
	"set_proc_group_dex2oat",
	"set_proc_group_fg",
	"set_proc_group_nnapi",
	"set_proc_group_ota",
	"set_proc_group_rt",
	"set_proc_group_sf",
	"set_proc_group_sys",
	"set_proc_group_sysbg",
	"set_proc_group_ta",
	"set_task_group_bg",
	"set_task_group_cam",
	"set_task_group_cam_power",
	"set_task_group_dex2oat",
	"set_task_group_fg",
	"set_task_group_nnapi",
	"set_task_group_ota",
	"set_task_group_rt",
	"set_task_group_sf",
	"set_task_group_sys",
	"set_task_group_sysbg",
	"set_task_group_ta",
	"sf_prefer_high_cap",
	"sf_prefer_idle",
	"sf_preferred_idle_mask_high",
	"sf_preferred_idle_mask_low",
	"sf_preferred_idle_mask_mid",
	"sf_task_spreading",
	"sf_uclamp_max",
	"sf_uclamp_max_on_nice_enable",
	"sf_uclamp_max_on_nice_high_prio",
	"sf_uclamp_max_on_nice_high_value",
	"sf_uclamp_max_on_nice_low_prio",
	"sf_uclamp_max_on_nice_low_value",
	"sf_uclamp_max_on_nice_mid_prio",
	"sf_uclamp_max_on_nice_mid_value",
	"sf_uclamp_min",
	"sf_uclamp_min_on_nice_enable",
	"sf_uclamp_min_on_nice_high_prio",
	"sf_uclamp_min_on_nice_high_value",
	"sf_uclamp_min_on_nice_low_prio",
	"sf_uclamp_min_on_nice_low_value",
	"sf_uclamp_min_on_nice_mid_prio",
	"sf_uclamp_min_on_nice_mid_value",
	"sf_ug",
	"sys_prefer_high_cap",
	"sys_prefer_idle",
	"sys_preferred_idle_mask_high",
	"sys_preferred_idle_mask_low",
	"sys_preferred_idle_mask_mid",
	"sys_task_spreading",
	"sys_uclamp_max",
	"sys_uclamp_max_on_nice_enable",
	"sys_uclamp_max_on_nice_high_prio",
	"sys_uclamp_max_on_nice_high_value",
	"sys_uclamp_max_on_nice_low_prio",
	"sys_uclamp_max_on_nice_low_value",
	"sys_uclamp_max_on_nice_mid_prio",
	"sys_uclamp_max_on_nice_mid_value",
	"sys_uclamp_min",
	"sys_uclamp_min_on_nice_enable",
	"sys_uclamp_min_on_nice_high_prio",
	"sys_uclamp_min_on_nice_high_value",
	"sys_uclamp_min_on_nice_low_prio",
	"sys_uclamp_min_on_nice_low_value",
	"sys_uclamp_min_on_nice_mid_prio",
	"sys_uclamp_min_on_nice_mid_value",
	"sys_ug",
	"sysbg_prefer_high_cap",
	"sysbg_prefer_idle",
	"sysbg_preferred_idle_mask_high",
	"sysbg_preferred_idle_mask_low",
	"sysbg_preferred_idle_mask_mid",
	"sysbg_task_spreading",
	"sysbg_uclamp_max",
	"sysbg_uclamp_max_on_nice_enable",
	"sysbg_uclamp_max_on_nice_high_prio",
	"sysbg_uclamp_max_on_nice_high_value",
	"sysbg_uclamp_max_on_nice_low_prio",
	"sysbg_uclamp_max_on_nice_low_value",
	"sysbg_uclamp_max_on_nice_mid_prio",
	"sysbg_uclamp_max_on_nice_mid_value",
	"sysbg_uclamp_min",
	"sysbg_uclamp_min_on_nice_enable",
	"sysbg_uclamp_min_on_nice_high_prio",
	"sysbg_uclamp_min_on_nice_high_value",
	"sysbg_uclamp_min_on_nice_low_prio",
	"sysbg_uclamp_min_on_nice_low_value",
	"sysbg_uclamp_min_on_nice_mid_prio",
	"sysbg_uclamp_min_on_nice_mid_value",
	"sysbg_ug",
	"ta_prefer_high_cap",
	"ta_prefer_idle",
	"ta_preferred_idle_mask_high",
	"ta_preferred_idle_mask_low",
	"ta_preferred_idle_mask_mid",
	"ta_task_spreading",
	"ta_uclamp_max",
	"ta_uclamp_max_on_nice_enable",
	"ta_uclamp_max_on_nice_high_prio",
	"ta_uclamp_max_on_nice_high_value",
	"ta_uclamp_max_on_nice_low_prio",
	"ta_uclamp_max_on_nice_low_value",
	"ta_uclamp_max_on_nice_mid_prio",
	"ta_uclamp_max_on_nice_mid_value",
	"ta_uclamp_min",
	"ta_uclamp_min_on_nice_enable",
	"ta_uclamp_min_on_nice_high_prio",
	"ta_uclamp_min_on_nice_high_value",
	"ta_uclamp_min_on_nice_low_prio",
	"ta_uclamp_min_on_nice_low_value",
	"ta_uclamp_min_on_nice_mid_prio",
	"ta_uclamp_min_on_nice_mid_value",
	"ta_ug",
	"tapered_dvfs_headroom_enable",
	"uclamp_fork_reset_clear",
	"uclamp_fork_reset_set",
	"uclamp_max_filter_divider",
	"uclamp_max_filter_enable",
	"uclamp_max_filter_rt",
	"uclamp_min_filter_enable",
	"uclamp_min_filter_rt",
	"uclamp_min_filter_us",
	"ug_bg_auto_prio",
	"ug_bg_group_throttle",
	"ug_bg_uclamp_max",
	"ug_bg_uclamp_min",
	"ug_fg_group_throttle",
	"ug_fg_uclamp_max",
	"ug_fg_uclamp_min",
	"util_post_init_scale",
	"util_threshold"
};

static ssize_t vh_sched_dummy_store(struct file *filp,
				    const char __user *ubuf,
				    size_t count, loff_t *pos)
{
	return count;
}

static int vh_sched_dummy_proc_open(struct inode *inode, struct file *file)
{
	return single_open(file, NULL, NULL);
}

static const struct proc_ops vh_sched_dummy_proc_ops = {
	.proc_open = vh_sched_dummy_proc_open,
	.proc_release = single_release,
	.proc_write = vh_sched_dummy_store
};

static int __init no_vh_sched_init(void)
{
	struct proc_dir_entry *dir;
	int i;

	dir = proc_mkdir("vendor_sched", NULL);
	if (!dir)
		return -ENOMEM;

	for (i = 0; i < ARRAY_SIZE(vh_sched_nodes); i++)
		proc_create(vh_sched_nodes[i], 0200, dir,
			    &vh_sched_dummy_proc_ops);

	return 0;
}
late_initcall(no_vh_sched_init);
